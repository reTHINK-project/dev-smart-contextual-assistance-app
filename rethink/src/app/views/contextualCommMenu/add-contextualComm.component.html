<ng-template #content let-c="close" let-d="dismiss">

  <div class="row justify-content-center">
    <div class="col-8">

      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">{{title}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="d('Cross click')">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <form class="context" [formGroup]="complexForm" (ngSubmit)="submitForm(complexForm.value)" (submit)="d('success')">

        <div class="modal-body">

          <div class="form-group {{ complexForm.controls['name'].errors ? 'has-danger' : 'has-success' }}">
            <label for="name">Context Name</label>
            
            <input type="text" id="name" formControlName="name" class="form-control {{ complexForm.controls['name'].errors ? 'form-control-danger' : 'form-control-success' }}"
               [formControl]="complexForm.controls['name']" (blur)="onLostFocus($event)"
               aria-describedby="nameHelp" placeholder="Context name">

            <!-- <div class="form-control-feedback">Success! You've done it.</div> -->

            <div *ngIf="complexForm.controls['name'].errors" class="form-control-feedback">
              <span [hidden]="!complexForm.controls['name'].errors.exist">This context name already taken</span>
              <span [hidden]="!complexForm.controls['name'].errors.required">Don't forget the context name.</span>
              <span [hidden]="!complexForm.controls['name'].errors.pattern">Contexts names can't contain spaces, periods, or most punctuation.</span>
              <span [hidden]="!complexForm.controls['name'].errors.minlength">Name must be at least 4 characters long.</span>
              <span [hidden]="!complexForm.controls['name'].errors.maxlength">Name cannot be more than 22 characters long.</span>
            </div>
            <!-- Contexts names can't contain spaces, periods, or most punctuation. Try again?-->
            <small id="nameHelp" class="form-text text-muted">Contexts names must be lowercase, without spaces or periods, and shorter than 22 characters</small>

          </div>

          <div class="form-group">
            <label for="icon">Icons</label>

            <div id="icons" class="form-control form-group-control" formControlName="icon" [formControl]="complexForm.controls['icon']" ngbRadioGroup name="icon">
              <label *ngFor="let icon of icons; let i = index" class="btn btn-primary">
                <input type="radio" name="icons" id="{{icon}}" value="{{icon}}" autocomplete="off"><i class="fa fa-{{icon}}"></i> 
              </label>
            </div>

          </div>


          <div class="form-group {{ complexForm.controls['parent'].errors ? 'has-danger' : 'has-success' }}">
            <label>Select the main context</label>

            <select class="form-control" formControlName="parent" [formControl]="complexForm.controls['parent']">
              <option selected value=null>Choose...</option>
              <option *ngFor="let context of contextualComms | async;" [value]="context.id">{{context.name}}</option>
            </select>

            <div *ngIf="complexForm.controls['parent'].errors" class="form-control-feedback">
              <span [hidden]="!complexForm.controls['parent'].errors.required">Main context is required</span>
            </div>

          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="c('Close click')">Close</button>
          <button type="submit" class="btn btn-success" [disabled]="!complexForm.valid">Save changes</button>
        </div>

<!--        <p>Form value: {{ complexForm.value | json }}</p>
        <p>Form status: {{ complexForm.status | json }}</p>-->

      </form>
    </div>
  </div>

</ng-template>

<a href="javascript:;" class="add-button" (click)="open(content)">
  <span class="add-user"><a href="javascript:;">+</a></span>
  <span class="add-text">new context</span>
</a>